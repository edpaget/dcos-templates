#cloud-config
"coreos":
  "units":
  - "command": |-
      stop
    "mask": !!bool |-
      true
    "name": |-
      etcd.service
  - "command": |-
      stop
    "mask": !!bool |-
      true
    "name": |-
      update-engine.service
  - "command": |-
      stop
    "mask": !!bool |-
      true
    "name": |-
      locksmithd.service
  - "command": |-
      stop
    "name": |-
      systemd-resolved.service
  - "command": |-
      start
    "content": |
      [Unit]
      Description=Formats the /var/lib ephemeral drive
      Before=var-lib.mount dbus.service
      [Service]
      Type=oneshot
      RemainAfterExit=yes
      ExecStart=/bin/bash -c "(blkid -t TYPE=ext4 | grep xvdb) || (/usr/sbin/mkfs.ext4 -F /dev/xvdb)"
    "name": |-
      format-var-lib-ephemeral.service
  - "command": |-
      start
    "content": |
      [Unit]
      Description=Formats the /shared EBS device
      Before=shared.mount dbus.service
      [Service]
      Type=oneshot
      RemainAfterExit=yes
      ExecStart=/bin/bash -c "(blkid -t TYPE=ext4 | grep xvdc) || (/usr/sbin/mkfs.ext4 -F /dev/xvdc)"
      ExecStartPost=/usr/bin/mkdir /shared
      ExecStartPost=/usr/bin/touch /var/lib/nfs/etab
    "name": |-
      format-shared-nfsd.service
  - "command": |-
      start
    "content": |
      [Unit]
      Description=Mount /var/lib
      Before=dbus.service
      [Mount]
      What=/dev/xvdb
      Where=/var/lib
      Type=ext4
    "name": |-
      var-lib.mount
  - "command": |-
      start
    "content": |
      [Unit]
      Description=Mount /shared
      Before=nfsd-hack.service rpc-mountd.service
      [Mount]
      What=/dev/xvdc
      Where=/shared
      Type=ext4
    "name": |-
      shared.mount
  - "command": |-
      start
    "content": |
      [Unit]
      Description=Unmasks and launches NFS Server
      Before=dbus.service
      [Service]
      Type=oneshot
      RemainAfterExit=false
      ExecStart=systemctl unmask nfsd
      ExecStartPost=systemctl unmask rpc-mountd
      ExecStartPost=systemctl enable nfsd
      ExecStartPost=systemctl enable rpc-mountd
      ExecStartPost=systemctl start nfsd
      ExecStartPost=systemctl start rpc-mountd
    "name": |-
      nfsd-hack.service
  - "command": |-
      restart
    "name": |-
      systemd-journald.service
  - "command": |-
      restart
    "name": |-
      docker.service
  "update":
    "reboot-strategy": |-
      off
write_files:
- "content": |
    /shared/ 10.0.0.0/16(rw,async,no_subtree_check,no_all_squash,no_root_squash,fsid=0)
  "owner": |-
    root
  "path": |-
    /etc/exports
  permissions: |-
    0644
- "content": |
    https://downloads.mesosphere.com/dcos/stable
  "owner": |-
    root
  "path": |-
    /etc/mesosphere/setup-flags/repository-url
  "permissions": |-
    0644
- "content": |
    BOOTSTRAP_ID=18d094b1648521b017622180e3a8e05788a81e80
  "owner": |-
    root
  "path": |-
    /etc/mesosphere/setup-flags/bootstrap-id
  "permissions": |-
    0644
- "content": |
    ["dcos-config--setup_4597f57ee78b805648fda7ebc52e57aa209351c9", "dcos-metadata--setup_4597f57ee78b805648fda7ebc52e57aa209351c9"]
  "owner": |-
    root
  "path": |-
    /etc/mesosphere/setup-flags/cluster-packages.json
  "permissions": |-
    0644
- "content": |
    [Journal]
    MaxLevelConsole=warning
  "owner": |-
    root
  "path": |-
    /etc/systemd/journald.conf.d/dcos.conf
  "permissions": |-
    0644
- "content": |
    arn:aws-us-gov:cloudformation:us-gov-west-1:119768426323:stack/dcos-gov-test-4/5e04a3e0-0c9d-11e6-9858-500162c6f4fe
  "path": |-
    /etc/mesosphere/cluster-id
  "permissions": |-
    0644
- "content": |
    AWS_REGION=us-gov-west-1
    AWS_STACK_ID=arn:aws-us-gov:cloudformation:us-gov-west-1:119768426323:stack/dcos-gov-test-4/5e04a3e0-0c9d-11e6-9858-500162c6f4fe
    AWS_STACK_NAME=dcos-gov-test-4
    AWS_IAM_MASTER_ROLE_NAME=dcos-gov-test-4-MasterRole-B8QY1W86WYU5
    AWS_IAM_SLAVE_ROLE_NAME=dcos-gov-test-4-SlaveRole-1JWJ25WE0S2ES
  "path": |-
    /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/cfn_signal_metadata
- "content": |
    MESOS_CLUSTER=dcos-gov-test-4
  "path": |-
    /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/mesos-master-provider
- "content": |
    MASTER_SOURCE=exhibitor
    EXHIBITOR_ADDRESS=internal-dcos-gov-Internal-KB2WKH4A1GIL-862050613.us-gov-west-1.elb.amazonaws.com
    RESOLVERS=169.254.169.253
  "path": |-
    /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/dns_config
- "content": |
    EXHIBITOR_BACKEND=AWS_S3
    AWS_REGION=us-gov-west-1
    AWS_S3_BUCKET=dcos-gov-test-4-exhibitors3bucket-x8qirormvq7b
    AWS_S3_PREFIX=dcos-gov-test-4
  "path": |-
    /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor
- "content": |-
    {}
  "path": |-
    /etc/mesosphere/setup-packages/dcos-provider-aws--setup/pkginfo.json
- "content": ""
  "path": |-
    /etc/mesosphere/roles/master
- "content": ""
  "path": |-
    /etc/mesosphere/roles/aws_master
- "content": ""
  "path": |-
    /etc/mesosphere/roles/aws
